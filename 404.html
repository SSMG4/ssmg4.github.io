<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>404 - Not Found | SSMG4</title>
  <link rel="icon" href="https://ssmg4.github.io/assets/favicon.ico">
  <link rel="stylesheet" href="https://ssmg4.github.io/assets/css/styles.css">
  <link rel="preload" as="font" href="https://ssmg4.github.io/assets/fonts/mojangles.ttf" type="font/ttf" crossorigin>
  <style>
    /* Fix for Bug #1: Hide controls on PC, show on Mobile */
    .mobile-controls {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 1.5rem;
      gap: 10px;
    }

    /* Only show if the device supports touch */
    @media (pointer: coarse) {
      .mobile-controls {
        display: flex;
      }
    }

    /* Fix for Bug #2: Proper Centering */
    .control-row {
      display: flex;
      justify-content: center;
      gap: 15px;
      width: 100%;
    }

    #snake {
      image-rendering: pixelated; /* Keeps it sharp */
      max-width: 90vw; /* Responsive for small screens */
    }
  </style>
</head>
<body>
  <div class="main-container" style="text-align:center;">
    <h1 style="font-family:'Mojangles',sans-serif;font-size:2.2rem;margin-top:3rem;">404: Page Not Found</h1>
    <p style="font-size:1.15rem;margin:1.2rem auto 1.7rem;max-width:400px;">
      Oops! This page doesn't exist.<br>
      Want to play a quick game of snake while you're here?
    </p>
    <button class="colorful-btn" onclick="startSnake()">üêç Play Snake</button>

    <div id="game-container" style="display:none;margin-top:2rem;">
      <h2 style="font-family:'Mojangles',sans-serif;">Score: <span id="current-score">0</span></h2>
      <canvas id="snake" width="300" height="300" style="background:#222;border:3px solid #fff;border-radius:12px;"></canvas>
      
      <div class="mobile-controls">
        <div class="control-row">
          <button class="repo-link" style="padding: 15px 25px;" onclick="setDirection('UP')">‚¨ÜÔ∏è</button>
        </div>
        <div class="control-row">
          <button class="repo-link" style="padding: 15px 25px;" onclick="setDirection('LEFT')">‚¨ÖÔ∏è</button>
          <button class="repo-link" style="padding: 15px 25px;" onclick="setDirection('DOWN')">‚¨áÔ∏è</button>
          <button class="repo-link" style="padding: 15px 25px;" onclick="setDirection('RIGHT')">‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <p style="margin-top:2.5rem;"><a href="/" class="repo-link">Back to Home</a></p>
  </div>

  <script>
    let canvas = document.getElementById("snake");
    let ctx = canvas.getContext("2d");
    const box = 15; // 300 / 15 = 20 tiles
    let snake, food, direction, nextDirection, game, score;

    function startSnake() {
      document.getElementById("game-container").style.display = "block";
      // Reset variables
      score = 0;
      document.getElementById("current-score").innerText = score;
      direction = "RIGHT";
      nextDirection = "RIGHT"; // Buffer to prevent self-collision
      snake = [{ x: 5 * box, y: 10 * box }];
      spawnFood();
      
      document.addEventListener("keydown", dirControl);
      clearInterval(game);
      // Fix for Bug #4: Reduced interval from 190ms to 130ms for snappier response
      game = setInterval(drawGame, 130); 
    }

    function spawnFood() {
      food = {
        x: Math.floor(Math.random() * 20) * box,
        y: Math.floor(Math.random() * 20) * box
      };
      // Prevent food from spawning on snake body
      if (snake.some(s => s.x === food.x && s.y === food.y)) spawnFood();
    }

    function dirControl(e) {
      if (e.key === "ArrowLeft") setDirection('LEFT');
      if (e.key === "ArrowUp") setDirection('UP');
      if (e.key === "ArrowRight") setDirection('RIGHT');
      if (e.key === "ArrowDown") setDirection('DOWN');
    }

    function setDirection(dir) {
      // Logic to prevent 180-degree turns
      if (dir === "LEFT" && direction !== "RIGHT") nextDirection = "LEFT";
      else if (dir === "UP" && direction !== "DOWN") nextDirection = "UP";
      else if (dir === "RIGHT" && direction !== "LEFT") nextDirection = "RIGHT";
      else if (dir === "DOWN" && direction !== "UP") nextDirection = "DOWN";
    }

    function drawGame() {
      direction = nextDirection; // Apply direction change at the start of the frame
      
      ctx.fillStyle = "#222";
      ctx.fillRect(0, 0, 300, 300);

      // Draw Food
      ctx.fillStyle = "#ff4d6d";
      ctx.fillRect(food.x, food.y, box, box);

      // Draw Snake
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = (i === 0) ? "#ffd200" : "#8f6ae7";
        ctx.fillRect(snake[i].x, snake[i].y, box, box);
        // Add a small border to segments for visibility
        ctx.strokeStyle = "#222";
        ctx.strokeRect(snake[i].x, snake[i].y, box, box);
      }

      let headX = snake[0].x;
      let headY = snake[0].y;

      if (direction === "LEFT") headX -= box;
      if (direction === "RIGHT") headX += box;
      if (direction === "UP") headY -= box;
      if (direction === "DOWN") headY += box;

      // Fix for Bug #3: Collision Check
      // We check against 300 (the width) and < 0
      if (headX < 0 || headX >= 300 || headY < 0 || headY >= 300 || collision(headX, headY, snake)) {
        clearInterval(game);
        alert("Oops, game over! Score: " + score);
        location.reload();
        return;
      }

      if (headX === food.x && headY === food.y) {
        score++;
        document.getElementById("current-score").innerText = score;
        spawnFood();
      } else {
        snake.pop();
      }

      snake.unshift({ x: headX, y: headY });
    }

    function collision(x, y, array) {
      for (let i = 0; i < array.length; i++) {
        if (x === array[i].x && y === array[i].y) return true;
      }
      return false;
    }
  </script>
</body>
</html>
