<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>404 - Not Found | SSMG4</title>
  <link rel="icon" href="https://ssmg4.github.io/assets/favicon.ico">
  <link rel="stylesheet" href="https://ssmg4.github.io/assets/css/styles.css">
  <link rel="preload" as="font" href="https://ssmg4.github.io/assets/fonts/mojangles.ttf" type="font/ttf" crossorigin>
  <style>
    .mobile-controls {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 1.5rem;
      gap: 10px;
    }
    @media (pointer: coarse) {
      .mobile-controls { display: flex; }
    }
    .control-row {
      display: flex;
      justify-content: center;
      gap: 15px;
      width: 100%;
    }
    #snake {
      image-rendering: pixelated;
      max-width: 90vw;
    }
    /* Prevents persistent orange highlight on mobile devices */
    .repo-link {
        -webkit-tap-highlight-color: transparent;
        user-select: none;
    }
  </style>
</head>
<body>
  <div class="main-container" style="text-align:center;">
    <h1 style="font-family:'Mojangles',sans-serif;font-size:2.2rem;margin-top:3rem;">404: Page Not Found</h1>
    <p style="font-size:1.15rem;margin:1.2rem auto 1.7rem;max-width:400px;">
      Oops! This page doesn't exist.<br>
      Want to play a quick game of snake while you're here?
    </p>
    <button class="colorful-btn" onclick="startSnake()">üêç Play Snake</button>

    <div id="game-container" style="display:none;margin-top:2rem;">
      <h2 style="font-family:'Mojangles',sans-serif;">Score: <span id="current-score">0</span></h2>
      <canvas id="snake" width="300" height="300" style="background:#222;border:3px solid #fff;border-radius:12px;"></canvas>
      
      <div class="mobile-controls">
        <div class="control-row">
          <button class="repo-link" style="padding: 15px 25px;" onpointerdown="setDirection('UP')" onpointerup="this.blur()">‚¨ÜÔ∏è</button>
        </div>
        <div class="control-row">
          <button class="repo-link" style="padding: 15px 25px;" onpointerdown="setDirection('LEFT')" onpointerup="this.blur()">‚¨ÖÔ∏è</button>
          <button class="repo-link" style="padding: 15px 25px;" onpointerdown="setDirection('DOWN')" onpointerup="this.blur()">‚¨áÔ∏è</button>
          <button class="repo-link" style="padding: 15px 25px;" onpointerdown="setDirection('RIGHT')" onpointerup="this.blur()">‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <p style="margin-top:2.5rem;"><a href="/" class="repo-link">Back to Home</a></p>
  </div>

  <script>
    let canvas = document.getElementById("snake");
    let ctx = canvas.getContext("2d");
    const box = 15;
    let snake, food, direction, game, score, gameActive;
    let inputQueue = []; // Fixed: Queues fast inputs so none are missed

    function startSnake() {
      document.getElementById("game-container").style.display = "block";
      score = 0;
      document.getElementById("current-score").innerText = score;
      direction = ""; 
      gameActive = false;
      inputQueue = [];
      snake = [{ x: 9 * box, y: 9 * box }];
      spawnFood();
      
      document.addEventListener("keydown", dirControl);
      clearInterval(game);
      game = setInterval(drawGame, 190); 
    }

    function spawnFood() {
      food = {
        x: Math.floor(Math.random() * 20) * box,
        y: Math.floor(Math.random() * 20) * box
      };
      if (snake.some(s => s.x === food.x && s.y === food.y)) spawnFood();
    }

    function dirControl(e) {
      if (e.key === "ArrowLeft") setDirection('LEFT');
      if (e.key === "ArrowUp") setDirection('UP');
      if (e.key === "ArrowRight") setDirection('RIGHT');
      if (e.key === "ArrowDown") setDirection('DOWN');
    }

    function setDirection(dir) {
      if (!gameActive) gameActive = true;
      
      // Get the last intended direction (either current or last in queue)
      const lastDir = inputQueue.length > 0 ? inputQueue[inputQueue.length - 1] : direction;

      if (dir === "LEFT" && lastDir !== "RIGHT") inputQueue.push("LEFT");
      else if (dir === "UP" && lastDir !== "DOWN") inputQueue.push("UP");
      else if (dir === "RIGHT" && lastDir !== "LEFT") inputQueue.push("RIGHT");
      else if (dir === "DOWN" && lastDir !== "UP") inputQueue.push("DOWN");
    }

    function drawGame() {
      // Process the next move in the queue
      if (inputQueue.length > 0) {
          direction = inputQueue.shift();
      }

      let headX = snake[0].x;
      let headY = snake[0].y;

      if (gameActive) {
        if (direction === "LEFT") headX -= box;
        if (direction === "RIGHT") headX += box;
        if (direction === "UP") headY -= box;
        if (direction === "DOWN") headY += box;

        if (headX === food.x && headY === food.y) {
          score++;
          document.getElementById("current-score").innerText = score;
          spawnFood();
        } else {
          snake.pop();
        }
        snake.unshift({ x: headX, y: headY });
      }

      ctx.fillStyle = "#222";
      ctx.fillRect(0, 0, 300, 300);
      ctx.fillStyle = "#ff4d6d";
      ctx.fillRect(food.x, food.y, box, box);

      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = (i === 0) ? "#ffd200" : "#8f6ae7";
        ctx.fillRect(snake[i].x, snake[i].y, box, box);
      }

      if (gameActive) {
        if (snake.length >= 400) {
          clearInterval(game);
          setTimeout(() => { alert("CONGRATULATIONS! ü•≥üéâ"); location.reload(); }, 10);
          return;
        }

        if (headX < 0 || headX >= 300 || headY < 0 || headY >= 300 || collision(headX, headY, snake)) {
          clearInterval(game);
          setTimeout(() => { alert("Oops, game over! Score: " + score); location.reload(); }, 10);
          return;
        }
      }
    }

    function collision(x, y, array) {
      for (let i = 1; i < array.length; i++) {
        if (x === array[i].x && y === array[i].y) return true;
      }
      return false;
    }

    // Surgical fix for sticky mobile button states
    document.addEventListener('touchend', () => {
        if (document.activeElement && document.activeElement.tagName === 'BUTTON') {
            document.activeElement.blur();
        }
    }, { passive: true });
  </script>
</body>
</html>
