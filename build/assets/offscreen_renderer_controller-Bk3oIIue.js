import{C as l}from"./pulsar-Z0XEwoqe.js";import{S as n}from"./viewer-Dr3l7UVh.js";import.meta.stimulusFetch="lazy";import.meta.stimulusIdentifier="offscreen-renderer";class d extends l{static targets=["item"];static values={viewType:{type:String,default:"skins"},batchSize:{type:Number,default:5}};connect(){this.renderAllItems()}async renderAllItems(){const t=this.itemTargets.filter(e=>e.getAttribute("data-url")),r=this.batchSizeValue;for(let e=0;e<t.length;e+=r){const i=t.slice(e,e+r).map(s=>this.renderItem(s));await Promise.all(i)}}async renderItem(t){const r=t.getAttribute("data-url").replace("http://","https://");if(!r)return;const e=await this.createSkinViewer();try{this.viewTypeValue==="skins"?await e.loadSkin(r):await e.loadCape(r),e.fxaaPass.enabled=!0,e.render();const a=e.canvas.toDataURL();this.replaceImage(t,a),this.dispatch("renderComplete",{detail:{url:r}})}catch(a){this.dispatch("renderError",{detail:{url:r,error:a}})}finally{e.dispose()}}async createSkinViewer(){const t=new n({width:200,height:210,renderPaused:!0});return t.fov=35,this.viewTypeValue==="skins"?(t.playerWrapper.rotation.y=325*Math.PI/180,t.playerWrapper.rotation.x=20.55*Math.PI/180,t.zoom=.9):(t.playerWrapper.rotation.y=575/Math.PI,t.playerObject.cape.position.z=0,t.playerObject.cape.rotation.x=0,t.playerWrapper.rotation.y=Math.PI,t.playerObject.skin.visible=!1,t.zoom=1.5),t}replaceImage(t,r){t.innerHTML="";const e=document.createElement("img");e.src=r,e.style.width="200px",e.style.height="300px",e.style.filter="drop-shadow(-8px 4px 6px rgba(0, 0, 0, 0.25))",e.style.maxWidth="180%",e.style.height="auto",e.style.margin="0 -40%",e.alt="Rendered Skin/Cape",e.setAttribute("draggable","false"),t.appendChild(e)}}export{d as default};
